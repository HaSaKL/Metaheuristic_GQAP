---
title: "Statistical Inference for GRASP-Solver Parameters"
author: "Hagen Salewski"
date: "14. Februar 2016"
output: html_document
---

# Synopsis

This reports compares the runtime of different realizations of Greedy Randomized Adaptive Search Procedures (GRASP) with Path-Relinking to solve the Generalized Quadratic Assignment Problem (GQAP). The implementation of the algorithms can be found at <https://github.com/HaSaKL/Metaheuristic_GQAP/src/>. The problem instance compated here is the 50-10-65 instance described by Cordeau, it can be found at <FIXME>. The data was generated by running 250 time-to-target runs using all  parameter variations. The purpose of this analysis is to find out, if GRASP-Initialization is better (faster) than a random initailization procedure and the best setting for the parameters which govern the Path-Relinking.

FIXME: Add description of results here.

The analysis is carried out using the Analysis of Variation (ANOVA)


# Data Processing

## Reading Data

I assume the data is stored in two separate files: 
- `ResultsLS+PR-Tests.csv`: This file contains the experiments which vary the initialization method (Random Intitialization and GRASP Initialization) and all other parameters.
- `ResultsLS+PR-Tests-quick.csv`: This file contains experiments use the quick GRASP intialization varying all other parameters.

```{r, cache=TRUE}
# read both data files 
dataNotQuick <- read.csv2(file = "ResultsLS+PR-Tests.csv", dec = ".", strip.white = T,  header=TRUE, fill = F, colClasses = c('factor', 'factor', 'factor', 'factor', 'factor', 'factor', 'numeric', 'numeric', 'numeric', 'numeric', 'numeric') )

dataQuick <- read.csv2(file = "ResultsLS+PR-Tests-quick.csv", dec = ".", strip.white = T,  header=TRUE, fill = F, colClasses = c('factor', 'factor', 'factor', 'factor', 'factor', 'factor', 'numeric', 'numeric', 'numeric', 'numeric', 'numeric') )
```

The Coding Scheme for the files can be found at <FIXME>. The header in each file names the variables. The two files use different variables, the latter also describes the PoolSize, which the first does not. However, in both test the used PoolSize was 10. This needs to be considerd by tidying the data

```{r, cache=TRUE}
# tidy data
dataNotQuick <- subset(dataNotQuick, select = -X)
dataQuick <- subset(dataQuick, select = -PoolSize)
```

The factor levels for the StartSol of the quick-GRASP are the same as for the regular GRASP. This needs to be changed to consider distinquish between GRASP and quick-GRASP.

```{r, cache=TRUE}
# recode factor levels for quick-GRASP
levels(dataQuick$StartSol)[levels(dataQuick$StartSol) == 3] <- 7
levels(dataQuick$StartSol)[levels(dataQuick$StartSol) == 4] <- 8
```

Finally the two data tables are combined.

```{r, cache=TRUE}
# merge quick and not quick data
data <- rbind(dataQuick, dataNotQuick)
```

## Label Data

Label factos according to coding scheme.

```{r, cache=TRUE}
# label data accoring to code book
data$StartSol <- factor(data$StartSol, 
                        levels = c(0,1,2,3,4,5,6,7,8),
                        labels = c("Random init", 
                                   "Greedy init", "Fixed alpha", "Reactive alpha", "Uniform random alpha",
                                   "Quick Greedy", "Quick Fixed", "Quick Reactive", "Quick Uniform Random"))

data$LSStrategy <- factor(data$LSStrategy,
                          levels = c(0,1,2),
                          labels = c("best improve", "random improve", "none"))

data$PRMeth <- factor(data$PRMeth,
                      levels = c(0,1,2,3),
                      labels = c("Random PR-Move Selector", "Greedy PR-Move Selector", "GRASP PR-Move Selector", "no PR"))

data$PRDir <- factor(data$PRDir,
                     levels = c(0,1,2),
                     labels = c("Forward", "Backward", "Mixed"))

data$PRPoolSelect <- factor(data$PRPoolSelect,
                            levels = c(0,1,2),
                            labels = c("Diverse", "Random", "All"))

```

## Filter relevant Data

More experiments have been run than required. This unblances the experiment design. Therefore, the data is filtered to have a balanced experiment design. Additionally, all unsed factors are reduced from the data set.

```{r, cache=TRUE}

# load dplyr-packe for filter()-function
library(dplyr)

# deselect unimportant variables
data_inf <- subset(data, select = Problem:Time)

# remove trials with Path-Relinking the GRASP PR-Move Selector, because the test have only been carried out for GRASP-Init and quick-GRASP-Init, not for Random Init.
data_inf <- filter(data_inf, PRMeth != "GRASP PR-Move Selector")

# drop unused facor-levels (e.g. GRASP PR-Move Selector, or other Initialization functions)
data_inf <- droplevels(data_inf)
```


# Performance Analysis for PRMeth and StartSol - aggregating over PRDIr and PRPoolSelect

This is heavily inspired by the [R factorial ANOVA Tutorial](http://ww2.coastal.edu/kingw/statistics/R-tutorials/factorial.html)

## Exploratory Plotting

```{r}
# Draw Boxplots
boxplot(Time ~ StartSol * PRMeth, data = data_inf, 
        ylab = "Time-to-Target", 
        main = "Boxplots of Time-to-Target ~ StartSol * PRMeth"
        )
```

Unfortunatly the results for Random Initialization and the Random PR-Move Selector contains a lot of outliners, which skews the boxplots. So here are the boxplots again with supressed outliners.

```{r}
# Draw Boxplots without outliners
boxplot(Time ~ StartSol * PRMeth, data = data_inf, 
        ylab = "Time-to-Target", 
        main = "Boxplots of Time-to-Target ~ StartSol * PRMeth", 
        outline = F
        )
```

An alternative for showing this is a conditional plot.

```{r}
# Draw condition plot
coplot(Time ~ StartSol | PRMeth, data = data_inf,
       panel = panel.smooth,
       xlab="Time-to-target data: Time vs. Initalization, given a the Move Selector")
```

Now for some interaction plots using the mean and the median function. The advantage of the median function is a more intuitive interpretation for for the time-to-taget runs: The time after which 50% of trials have found the target solution. 

```{r}
# draw an interaction plots
with(data_inf, interaction.plot(x.factor = PRMeth, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = mean, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Mean-values", 
                                pch=c(1,19, 10)
                                ))


with(data_inf, interaction.plot(x.factor = PRMeth, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot using Median-values", 
                                pch=c(1,19,10)
                                ))

```



## ANOVA-Analysis and post-tests

Fit an ANOVA-Model to the data. Possible problem with Anova: It requires normal distribution within groups and a homogeneous variation in the groups. Questions: Can the data be transformed to be normal? Are there other possible analysis I could run?

```{r}
aov.out <- aov(Time ~ StartSol * PRMeth, data = data_inf)
```

Show the model tables for first interpretation:

```{r}
model.tables(aov.out, type="means",se=T)
model.tables(aov.out, type="effects",se=T)
```

Print the ANOVA table:

```{r}
summary(aov.out)
```

Note: It is said (e.g. Wikipedia) that ANOVA is rather robust against deviations from its assumptions (normal distributed dependent variable and homgeneous variance in groups)

Questions here: 
- How do the results change if the outliners for random init and random move-selector are removed?
- How do the results chanve if the only pairs of StartSol-Variations are considered?


For additional information perform Tukeys Honest Significance Test, which is supposed to be extremly picky when it comes the the violations of the assumptions (normaly distributed data and homegenous variance.)

```{r}
TukeyHSD(aov.out)
```

Additional information might be avaiable if a pairwise T-test is run for the Time vs. StartSol and Time vs. PRMeth

```{r}
with(data_inf, pairwise.t.test(Time, StartSol, p.adjust.method = "bonferroni"))
with(data_inf, pairwise.t.test(Time, PRMeth, p.adjust.method = "bonferroni"))
```

Finally, for validation show the plots for the ANOVA. Here you can see, that no normal distribution is given.

```{r}
plot(aov.out)
```

# Performance Analysis over all Parameters


```{r, cache=TRUE}
# merge quick and not quick data
data <- rbind(dataQuick, dataNotQuick)
```

## Exploratory Plotting

```{r}
# draw an interaction plots
with(data_inf, interaction.plot(x.factor = PRDir, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))

with(data_inf, interaction.plot(x.factor = PRPoolSelect, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))


with(data_inf, interaction.plot(x.factor = PRDir, 
                                trace.factor = PRMeth, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))

with(data_inf, interaction.plot(x.factor = PRDir, 
                                trace.factor = PRPoolSelect, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))

with(data_inf, interaction.plot(x.factor = PRMeth, 
                                trace.factor = PRPoolSelect, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))


```



## ANOVA-Analysis and post-tests

Fit an ANOVA-Model to the data. Possible problem with Anova: It requires normal distribution within groups and a homogeneous variation in the groups. Questions: Can the data be transformed to be normal? Are there other possible analysis I could run?

```{r}
aov.out <- aov(Time ~ StartSol * PRMeth * PRDir * PRPoolSelect, data = data_inf)
```

Show the model tables for first interpretation:

```{r}
model.tables(aov.out, type="means",se=T)
model.tables(aov.out, type="effects",se=T)
```

Print the ANOVA table:

```{r}
summary(aov.out)
```

Note: It is said (e.g. Wikipedia) that ANOVA is rather robust against deviations from its assumptions (normal distributed dependent variable and homgeneous variance in groups)

Questions here: 
- How do the results change if the outliners for random init and random move-selector are removed?
- How do the results chanve if the only pairs of StartSol-Variations are considered?


Finally, for validation show the plots for the ANOVA. Here you can see, that no normal distribution is given.

```{r}
plot(aov.out)
```
