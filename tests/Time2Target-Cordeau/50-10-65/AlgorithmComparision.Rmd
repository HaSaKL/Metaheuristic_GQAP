---
title: "Statistical Inference for GRASP-Solver Parameters"
author: "Hagen Salewski"
date: "14. Februar 2016"
output: html_document
---

# Synopsis

This reports compares the runtime of different realizations of Greedy Randomized Adaptive Search Procedures (GRASP) with Path-Relinking to solve the Generalized Quadratic Assignment Problem (GQAP). The implementation of the algorithms can be found at [GitHub](https://github.com/HaSaKL/Metaheuristic_GQAP/tree/master/algorithm/src). The problem instance compated here is the 50-10-65 instance described by Cordeau, it can also be found at [http://neumann.hec.ca/chairedistributique/data/gqap/](http://neumann.hec.ca/chairedistributique/data/gqap/). The data was generated by running 250 time-to-target runs using all  parameter variations. The purpose of this analysis is to find out, if GRASP-Initialization is better (faster) than a random initailization procedure and the best setting for the parameters which govern the Path-Relinking.

The data file containing all Prameter Variations for the Random Initialization, the Quick-GRASP and the GRASP-Intialization can also be downloaded at [GitHub](https://github.com/HaSaKL/Metaheuristic_GQAP/blob/master/tests/Time2Target-Cordeau/50-10-65/Inits_vs_PRParams.csv).

The analysis is carried out using the Analysis of Variation (ANOVA)


# Data Processing

Read the relevant data.  This assumes the data file is download to the current working directory.

```{r echo=FALSE}
data_inf <- read.csv2("Inits_vs_PRParams.csv")
```

Remove the GRASP PR-Move Selector from the data, since it is only avaible for the GRASP and quick-GRASP intitializations.

```{r}
library(dplyr)
```

```{r}
# filter GRASP PR-Move Selector out
data_inf <- filter(data_inf, PRMeth != "GRASP PR-Move Selector")

# drop unused facor-levels (e.g. GRASP PR-Move Selector, or other Initialization functions)
data_inf <- droplevels(data_inf)
```

# Performance Analysis for PRMeth and StartSol - aggregating over PRDIr and PRPoolSelect

This is heavily inspired by the [R factorial ANOVA Tutorial](http://ww2.coastal.edu/kingw/statistics/R-tutorials/factorial.html)

## Exploratory Plotting

```{r}
# Draw Boxplots
boxplot(Time ~ StartSol * PRMeth, data = data_inf, 
        ylab = "Time-to-Target", 
        main = "Boxplots of Time-to-Target ~ StartSol * PRMeth"
        )
```

Unfortunatly the results for Random Initialization and the Random PR-Move Selector contains a lot of outliners, which skews the boxplots. So here are the boxplots again with supressed outliners.

```{r}
# Draw Boxplots without outliners
boxplot(Time ~ StartSol * PRMeth, data = data_inf, 
        ylab = "Time-to-Target", 
        main = "Boxplots of Time-to-Target ~ StartSol * PRMeth", 
        outline = F
        )
```

An alternative for showing this is a conditional plot.

```{r}
# Draw condition plot
coplot(Time ~ StartSol | PRMeth, data = data_inf,
       panel = panel.smooth,
       xlab="Time-to-target data: Time vs. Initalization, given a the Move Selector")
```

Now for some interaction plots using the mean and the median function. The advantage of the median function is a more intuitive interpretation for for the time-to-taget runs: The time after which 50% of trials have found the target solution. 

```{r}
# draw an interaction plots
with(data_inf, interaction.plot(x.factor = PRMeth, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = mean, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Mean-values", 
                                pch=c(1,19, 10)
                                ))


with(data_inf, interaction.plot(x.factor = PRMeth, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot using Median-values", 
                                pch=c(1,19,10)
                                ))

```



## ANOVA-Analysis and post-tests

Fit an ANOVA-Model to the data. Possible problem with Anova: It requires normal distribution within groups and a homogeneous variation in the groups. Questions: Can the data be transformed to be normal? Are there other possible analysis I could run?

```{r}
aov.out <- aov(Time ~ StartSol * PRMeth, data = data_inf)
```

Show the model tables for first interpretation:

```{r}
model.tables(aov.out, type="means",se=T)
model.tables(aov.out, type="effects",se=T)
```

Print the ANOVA table:

```{r}
summary(aov.out)
```

Note: It is said (e.g. Wikipedia) that ANOVA is rather robust against deviations from its assumptions (normal distributed dependent variable and homgeneous variance in groups)

Questions here: 
- How do the results change if the outliners for random init and random move-selector are removed?
- How do the results chanve if the only pairs of StartSol-Variations are considered?


For additional information perform Tukeys Honest Significance Test, which is supposed to be extremly picky when it comes the the violations of the assumptions (normaly distributed data and homegenous variance.)

```{r}
TukeyHSD(aov.out)
```

Additional information might be avaiable if a pairwise T-test is run for the Time vs. StartSol and Time vs. PRMeth

```{r}
with(data_inf, pairwise.t.test(Time, StartSol, p.adjust.method = "bonferroni"))
with(data_inf, pairwise.t.test(Time, PRMeth, p.adjust.method = "bonferroni"))
```

Finally, for validation show the plots for the ANOVA. Here you can see, that no normal distribution is given.

```{r}
plot(aov.out)
```

# Performance Analysis over all Parameters


## Exploratory Plotting

```{r}
# draw an interaction plots
with(data_inf, interaction.plot(x.factor = PRDir, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))

with(data_inf, interaction.plot(x.factor = PRPoolSelect, 
                                trace.factor = StartSol, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))


with(data_inf, interaction.plot(x.factor = PRDir, 
                                trace.factor = PRMeth, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))

with(data_inf, interaction.plot(x.factor = PRDir, 
                                trace.factor = PRPoolSelect, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))

with(data_inf, interaction.plot(x.factor = PRMeth, 
                                trace.factor = PRPoolSelect, 
                                response = Time, 
                                fun = median, 
                                type = "b", 
                                legend = T, 
                                ylab = "Time-to-Target", 
                                main = "Interaction Plot with Median-values", 
                                pch=c(1,19, 10)
                                ))


```



## ANOVA-Analysis and post-tests

Fit an ANOVA-Model to the data. Possible problem with Anova: It requires normal distribution within groups and a homogeneous variation in the groups. Questions: Can the data be transformed to be normal? Are there other possible analysis I could run?

```{r}
aov.out <- aov(Time ~ StartSol * PRMeth * PRDir * PRPoolSelect, data = data_inf)
```

Show the model tables for first interpretation:

```{r}
model.tables(aov.out, type="means",se=T)
model.tables(aov.out, type="effects",se=T)
```

Print the ANOVA table:

```{r}
summary(aov.out)
```

Note: It is said (e.g. Wikipedia) that ANOVA is rather robust against deviations from its assumptions (normal distributed dependent variable and homgeneous variance in groups)

Questions here: 
- How do the results change if the outliners for random init and random move-selector are removed?
- How do the results chanve if the only pairs of StartSol-Variations are considered?


Finally, for validation show the plots for the ANOVA. Here you can see, that no normal distribution is given.

```{r}
plot(aov.out)
```

# Appendix

## Distribution of Time-to-Target for selected experiments

```{r}
library(ggplot2)
```

```{r}
plotdata <- filter(data_inf, PRMeth == "Greedy PR-Move Selector", PRDir == "Mixed", PRPoolSelect == "All")

ggplot(data = plotdata, aes(y=Time/1000, x = StartSol)) +
  geom_violin() +
  geom_boxplot(width=0.1) +
  coord_flip() +
  labs(y = "Runtime in sec")
```

```{r}
plotdata <- filter(data_inf, PRMeth == "Random PR-Move Selector", PRDir == "Mixed", PRPoolSelect == "All")

ggplot(data = plotdata, aes(y=Time/1000, x = StartSol)) +
  geom_violin() +
  geom_boxplot(width=0.1) +
  coord_flip() +
  labs(y = "Runtime in sec")
```

```{r}
plotdata <- filter(data_inf, PRMeth == "Greedy PR-Move Selector", PRDir == "Forward", PRPoolSelect == "All")

ggplot(data = plotdata, aes(y=Time/1000, x = StartSol)) +
  geom_violin() +
  geom_boxplot(width=0.1) +
  coord_flip() +
  labs(y = "Runtime in sec")
```

```{r}
plotdata <- filter(data_inf, PRMeth == "Greedy PR-Move Selector", PRDir == "Backward", PRPoolSelect == "All")

ggplot(data = plotdata, aes(y=Time/1000, x = StartSol)) +
  geom_violin() +
  geom_boxplot(width=0.1) +
  coord_flip() +
  labs(y = "Runtime in sec")
```



